<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <title>抽奖</title>
    <link type="text/css" rel="stylesheet" href="css/style.css"/>
</head>
<body>
<div id="header" class="header">
    <h1>利趣返利网</h1>
</div>
<div id="content" class="content">
    <div class="move">
        <div class="wheel"></div>
        <div class="hand"><img src="images/hand.png"></div>
    </div>
    <div class="btn"><a href="##">开始抽奖</a></div>
    <dl class="rule_list">
        <dt>暗号抽奖规则：</dt>
        <dd>1、每天10点在微信服务号“利趣返利网”或用户QQ群中公布当日抽奖暗号（节假日除外）</dd>
        <dd>2、用户获得暗号后，可选择在微信服务号完成抽奖，或在PC端Q群抽奖中完成抽奖</dd>
        <dd>3、每个用户凭暗号只获得1次抽奖机会</dd>
        <dd>4、抽奖获得的集分宝将随着你的下次返利到账而发放</dd>
        <dd>5、具体抽奖信息请至PC端我的利趣中查看抽奖明细</dd>
    </dl>
</div>
<script src="js/zepto.min.js"></script>
<script src="js/zepto-touch.js"></script>
<script src="js/js.js"></script>
<script>
    /*
     0:再接再厉,
     40:集分宝,
     80:精美礼品，
     125:集分宝,
     175:再来一次,
     220:10元,
     265:祝你好运,
     310:50元
     */

    /*
     * 结果返回意义
     0:再接再厉,再来一次,祝你好运;
     1:集分宝;
     2:精美礼品;
     3:10元;
     4:50元
     */
    var resultJson={
        "0":"再接再厉",
        "40":"集分宝",
        "80":"精美礼品",
        "125":"集分宝",
        "175":"再来一次",
        "220":"10元",
        "265":"祝你好运",
        "310":"50元"
    };
    var localResult=true;
    if(window.localStorage){
        if(localStorage.resultDeg){//表示已经抽过奖了
            var resultMessage=resultJson[localStorage.resultDeg];
            alert("您已经抽过奖了!\n您的奖品是"+resultMessage);
        }
    }
    $('.btn,.hand').tap(function(){
        if(window.localStorage){
            if(localStorage.resultDeg){//表示已经抽过奖了
                var resultMessage=resultJson[localStorage.resultDeg];
                alert("您已经抽过奖了!/n您的奖品是"+resultMessage);
                return;
            }
        }
        $.ajax({
            url:"json/result.json",
            type:"get",
            success:function(json){
                var degVal=360*2;
                var resultDeg=0;
                if(json.message=="success"){
                    if(json.result==0){//0:再接再厉,再来一次,祝你好运;
                        var arr=[0,175,265];
                        var randomVal=Math.floor(Math.random()*3);
                        degVal+=arr[randomVal];
                        resultDeg=arr[randomVal];
                    }
                    else if(json.result==1){// 1:集分宝;
                        var arr=[40,125];
                        var randomVal=Math.floor(Math.random()*2);
                        degVal+=arr[randomVal];
                        resultDeg=arr[randomVal];
                    }
                    else if(json.result==2){//2:精美礼品;
                        degVal+=80;
                        resultDeg=80;
                    }
                    else if(json.result==3){//3:10元;
                        degVal+=220;
                        resultDeg=220;
                    }
                    else if(json.result==4){//4:50元
                        degVal+=310;
                        resultDeg=310;
                    }

                    var wheelNode=document.querySelector(".wheel");
                    wheelNode.style.transform="rotate("+degVal+"deg)";
                    wheelNode.style.WebkitTransform="rotate("+degVal+"deg)";
                    wheelNode.style.MozTransform="rotate("+degVal+"deg)";
                    wheelNode.style.OTransform="rotate("+degVal+"deg)";
                    wheelNode.style.MsTransform="rotate("+degVal+"deg)";

                    if(window.localStorage){
                        localStorage.resultDeg=resultDeg;
                    }
                }
                else{
                    alert("服务忙，请稍后重试")
                }
            },
            error:function(a,b,c){
                alert("服务忙，请稍后重试");
            }
        });
    });

</script>
</body>
</html>